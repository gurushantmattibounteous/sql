CREATE TABLE emp (
    eid SERIAL PRIMARY KEY,
    ename VARCHAR(100) NOT NULL,
    sal NUMERIC(10,2) NOT NULL
);

INSERT INTO emp (ename, sal) VALUES
('John', 50000.00),
('Alice', 62000.50),
('Robert', 45000.75),
('Sophia', 70000.00),
('David', 55000.25);

select * from emp;

select * from emp where sal = (select MAX(sal) from emp);

-- secondmax salary
select MAX(sal) as Second_max
From emp
where sal < (select max(sal) from emp);

-- full details

select * from emp where sal = (
select max(sal)
from emp
where sal < (select max(sal) from emp)
);

-- query to find the duplicate record

select ename, count(*)
from emp
group by ename
having count(*) > 1;



-- Employees 1 and 2 get manager as 3
UPDATE emp
SET manager = 3
WHERE eid IN (1, 2);

-- Employee 4 gets manager as 5
UPDATE emp
SET manager = 5
WHERE eid = 4;

-- Employee 5 manager is NULL (optional, default is already NULL)
UPDATE emp
SET manager = NULL
WHERE eid = 5;


UPDATE emp
SET manager = 4
WHERE eid = 3;





-- Drop the old manager column
ALTER TABLE emp DROP COLUMN manager;

-- Add manager as integer
ALTER TABLE emp ADD COLUMN manager INT;

-- Update manager IDs
UPDATE emp SET manager = 3 WHERE eid IN (1, 2);
UPDATE emp SET manager = 4 WHERE eid = 3;
UPDATE emp SET manager = 5 WHERE eid = 4;
UPDATE emp SET manager = NULL WHERE eid = 5;


-- sal > then manager
SELECT *
FROM emp e
WHERE sal > (
    SELECT sal
    FROM emp
    WHERE eid = e.manager
);


SELECT e.eid AS emp_id,
       e.ename AS emp_name,
       e.sal AS emp_salary,
       m.eid AS manager_id,
       m.ename AS manager_name,
       m.sal AS manager_salary
FROM emp e
JOIN emp m ON e.manager = m.eid
WHERE e.sal > m.sal;

-- add column depid
-- 1st 3 same dept
-- 4th and 3th different

alter table emp add column depid int;

select * from emp;

UPDATE emp
SET depid = 10
WHERE eid IN (1, 2);

UPDATE emp
SET depid = 20
WHERE eid IN (3, 4);

UPDATE emp
SET depid = 40
WHERE eid = 5;

-- add join date column
alter table emp add column doj date;

select * from emp;


-- adding the doj

UPDATE emp
SET doj = '2025-06-15'
WHERE eid = 1;

UPDATE emp
SET doj = '2025-08-10'
WHERE eid = 2;

UPDATE emp
SET doj = '2025-09-25'
WHERE eid = 3;

UPDATE emp
SET doj = '2025-11-05'
WHERE eid = 4;

UPDATE emp
SET doj = '2026-01-20'
WHERE eid = 5;


select * from emp;

-- emp who joined in last 6 month
SELECT CURRENT_DATE;

select * from emp
where doj >= CURRENT_DATE - INTERVAL '6 months'
order by doj desc;

-- creating the table dep
-- did and dname

CREATE TABLE dept (
    did INT PRIMARY KEY,
    dname VARCHAR(100) NOT NULL
);


INSERT INTO dept (did, dname) VALUES
(10, 'HR'),
(20, 'Finance'),
(30, 'IT'),
(40, 'Marketing');

select * from dept;

-- dept with  no emp
SELECT d.*
FROM dept d
LEFT JOIN emp e ON d.did = e.depid
WHERE e.eid IS NULL;

-- running salary of the dept
SELECT eid,
       ename,
       depid,
       sal,
       SUM(sal) OVER (PARTITION BY depid ORDER BY sal) AS running_total_sal
FROM emp
ORDER BY depid, sal;

-- rank for emp salary
SELECT eid,
       ename,
       sal,
       RANK() OVER (ORDER BY sal DESC) AS salary_rank
FROM emp;

-- add a gender column in the emp table

alter table emp add column gender varchar(100);

UPDATE emp
SET gender = 'Male'
WHERE eid IN (1, 3, 5);  -- John, Robert, David

UPDATE emp
SET gender = 'Female'
WHERE eid IN (2, 4);     -- Alice, Sophia

select * from emp;

-- count no of male and female dept wise
select * from emp

SELECT depid,
       COUNT(CASE WHEN gender = 'Male' THEN 1 END) AS male_count,
       COUNT(CASE WHEN gender = 'Female' THEN 1 END) AS female_count
FROM emp
GROUP BY depid
ORDER BY depid;

-- diff b/w current row and previous row salary
select "ename","sal","sal"-lag("sal") over (order by "eid") as sal_diff from "emp";


select "ename","sal","sal"+lead("sal") over (order by "eid") as sal_diff from "emp";

-- dept highest salary
SELECT depid,
       avg(sal) AS highest_salary
FROM emp
GROUP BY depid
ORDER BY depid;

WITH avgsal AS (
    SELECT depid,
           AVG(sal) AS avg_salary
    FROM emp
    GROUP BY depid
)
SELECT *
FROM avgsal
ORDER BY depid;


